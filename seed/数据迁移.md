## 数据迁移

从pg迁移到cassandra



### 1. 迁移历史数据（3个月）

需要解决的问题：partition及ttl

默认partion为month第一日

ttl为请求时传入，需要确认配置位置



### 2. 双写

需要解决的问题：双写

- 方案1：新启动一个tb服务（包含新数据库），tb-gateway 同时向新旧tb发送数据
- 方案2：修改tb代码，同时向pg和cassandra写入数据



### 3. 迁移增量数据

确认开始和结束的时间戳，使用第一步的方式迁移增量范围数据



### 4. 修改为cassandra读

确认数据无问题之后，修改tb为cassandra读



### 5. 关闭postgre写入

确认数据没有问题之后，关闭postgre写入，对应第二步